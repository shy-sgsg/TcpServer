# TcpServer

一个基于Qt框架开发的TCP文件接收服务器，能够监听指定端口并接收客户端发送的文件，支持文件传输状态跟踪和错误处理。

## 功能特点

- 基于Qt的TCP网络编程，支持多客户端连接
- 完整的文件接收流程，包括文件名、文件大小和文件内容的接收
- 自动创建文件保存目录
- 传输状态反馈（成功/失败）
- 错误处理和连接管理

## 技术栈

- C++
- Qt 5/6 (Widgets, Network模块)
- CMake 构建系统

## 项目结构

```
TcpServer/
├── CMakeLists.txt       # 项目构建配置
├── main.cpp             # 程序入口
├── tcpserver.h/cpp      # TCP服务器核心类
├── filereceiver.h/cpp   # 文件接收处理类
├── mainwindow.h/cpp     # 主窗口类（UI）
└── .gitignore           # Git忽略文件配置
```

## 编译与运行

### 前置条件

- Qt 5.15 或 Qt 6.x 开发环境
- CMake 3.16 及以上版本
- 支持C++17的编译器

### 编译步骤

1. 克隆仓库到本地
2. 使用Qt Creator打开CMakeLists.txt
3. 选择合适的构建套件（Kit）
4. 构建项目（Build）

### 运行

程序启动后会自动在65432端口监听连接，默认将接收的文件保存到以下目录：

```
E:/AIR/小长ISAR/实时数据回传/receive
```

（可在 `filereceiver.cpp`中修改保存路径）

## 工作原理

1. `TcpServer`类负责监听65432端口，等待客户端连接
2. 当有新连接时，创建 `FileReceiver`实例处理该连接
3. `FileReceiver`按照以下流程接收文件：
   - 接收文件名长度
   - 接收文件名
   - 接收文件大小
   - 接收文件内容并写入本地文件
   - 传输完成后发送状态反馈（SUCCESS/FAILURE）

## 自定义配置

- 更改监听端口：修改 `tcpserver.cpp`中的 `listen`调用参数
- 更改文件保存路径：修改 `filereceiver.cpp`中的 `saveDir`变量

## 注意事项

- 确保程序对保存目录有写入权限
- 大文件传输可能需要调整缓冲区设置
- 防火墙设置需允许65432端口的TCP连接

## 错误处理

程序会处理以下错误情况：

- 无效的文件名长度
- 无法创建文件进行写入
- 网络连接中断
- 传输过程中发生的socket错误

在发生错误时，会自动删除不完整的文件并通知客户端。
